var Game=function(){function n(n){this._whitePlayer=new Player(0,n),this._blackPlayer=new Player(1,n),this._board=n}return n.prototype.getLog=function(){return this._log},n.prototype.onLog=function(n){this._onLog=n},n.prototype.startNewGame=function(){this._log=[],this._whitePlayer.setStartPosition(),this._blackPlayer.setStartPosition(),this._playerToPlay=this._whitePlayer,this._nextPlayerToPlay=this._blackPlayer},n.prototype.moveById=function(n){var t=this._board.getSquareById(n);this.moveTo(t)},n.prototype.action=function(n,t){if(this._playerToPlay.getSelectedPiece()!=null){var i=this._board.getSelectedSquare(n,t);i.getPiece()!=null&&i.getPiece().getPlayer()==this._playerToPlay?this._playerToPlay.selectPiece(n,t):this.moveTo(i)}else this._playerToPlay.selectPiece(n,t)},n.prototype.moveTo=function(n){var t=this,r=this._playerToPlay,u=this._nextPlayerToPlay,i=r.getSelectedPiece(),f=i.getSquare();i!=null&&n!=null&&this.evaluateMove(r,i,n,function(e){var o,s,h;e.IsValid&&(e.IsCapture&&e.CapturedPieceSquare!=null&&(o=t._board.getSquareById(e.CapturedPieceSquare),s=o.getPiece(),s!=null&&(s.setSquare(null),o.setPiece(null),t._board.drawSquare(o))),e.IsPromotion&&i.changeType("Q"),r.move(i,n),e.EnPassantSquare!=null?(h=t._board.getSquareById(e.EnPassantSquare),t._board.setEnPassantSquare(h)):t._board.setEnPassantSquare(null),t._playerToPlay=u,t._nextPlayerToPlay=r,t.logPieceMove(i,f,n,e.IsCapture))},this.logError)},n.prototype.evaluateMove=function(n,t,i,r,u){var f={Board:{WhitePieces:this._whitePlayer.getPiecesAsStrings(),BlackPieces:this._blackPlayer.getPiecesAsStrings(),EnPassantSquare:this._board.getEnPassantSquare()!=null?this._board.getEnPassantSquare().getId():null},PlayerColor:n.getId(),From:t.getPosition(),To:i.getId()};Services.ChessEngine.move(f,r,u)},n.prototype.logError=function(n){alert(n)},n.prototype.logPieceMove=function(n,t,i,r){var u=n.getType();r&&(n.getType()==""&&(u+=t.getId()[0]),u+="x"),u+=i.getId(),this._log.push(u),this._onLog!=null&&this._onLog(u)},n}()